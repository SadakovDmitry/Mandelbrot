# Mandelbrot
### В данной работе представлено сравнение разных оптимизаций кода на С.
## Цель:
### Рассмотреть все возможные способы оптимизации программы на СИ и реализовать их.
## Ход работы:
### Напишем 4 программы показывающих графическое представление множество Мандельброта. Вот пример графического представления множества:

<img src="image.png" alt="drawing" width="600"/>

## Принцип работы программы в общем
+ ### При каждой итерации происходит расчет координат следующей точки по заданным ниже формулам, где x[0] и y[0] это координаты точки для которой мы считаем цвет.
+ ### Подсчет количества итераций останавливается если по итогу 256 итераций точка осталась в заданной области.
+ ### Цвет пикселей задается с помощью формулы (N, N % 8 * 32, 255 - N) в формате rgb где N это количество итераций при которых точка вылетает из заданной области, если же N = 256 то пиксель красится в черный цвет.
    * x[i] = x[i - 1]^2 - y[i - 1]^2 + x[0]
    * y[i] = 2 * x[i - 1] * y[i - 1] + y[0]

## Графический режим
* ### Стрелками мы можем двигать картинку в соответствующем направлении
* ### +/- увеличение и уменьшение масштаба соответственно
* ### ESC - выход из программы

## Описание программ
1. ### Первая программа("Mandelbrot.cpp"): перебираем все координаты точек в окне и для каждой из них вычисляется количество итераций после которого точка вылетит из заданной области. Далее в зависимости от количества итераций мы ставим цвет пикселя.

2. ### Вторая программа("Mandelbrot+.cpp"): Теперь будем перебирать точки по 4 и добавлять их в массив , вычисляя соответствующий массив итераций (количество итераций после которого точка вылетит из заданной области). Далее в зависимости от количества итераций мы ставим цвет пикселя.
### Посмотрим на то как наш компилятор переведет программу "Mandelbrot+.cpp" на Assembler
![Alt text](image-1.png)
### Видно что полученная программа на ассемблере очень схожа с "Mandelbrot++.cpp" так как компилятор автоматически преобразовал массивы в xmm регистры.

3. ### Третья программа("Mandelbrot++.cpp"): Теперь будем перебирать точки по 4 и добавлять, но вместо массивов будем использовать мультимедийные 128-битные регистры, и используя SIMD инструкции вычислять количество итераций после которого точка вылетит из заданной области. Далее в зависимости от количества итераций мы ставим цвет пикселя.
* #### Среднее fps третьей программы при стандартном зуме: 31.6 fps

4. ###  Четвертая программа("Mandelbrot256++.cpp"): Теперь будем перебирать точки по 8 и добавлять, но вместо массивов будем использовать мультимедийные 256-битные регистры, и используя SIMD инструкции вычислять количество итераций после которого точка вылетит из заданной области. Далее в зависимости от количества итераций мы ставим цвет пикселя.

| номер программы | c использованием -O3 | c использования -O0 | без использования оптимизации |
|-----------------|----------------------|---------------------|-------------------------------|
| 1               |            21.43 fps |            9.16 fps |                      9.56 fps |
| 2               |             6.86 fps |            0.80 fps |                      0.81 fps |
| 3               |            57.36 fps |           14.10 fps |                      7.81 fps |
| 4               |            75.11 fps |           17.72 fps |                     18.05 fps |



## Используемое оборудование
### Компилятор: Apple clang version 13.0.0 (clang-1300.0.29.30)
### Процессор: 2,4 GHz 2‑ядерный процессор Intel Core i5
### ОС: macOS Big Sur

## Вывод:
### Самым оптимальным оказался способ в котором мы заменяем работу с 8-ми символьными массивами на работу с мультимедивными 128-битными регистрами через SIMD инструкции и дополнительной оптимизацией с помощью флага -О3.

<img src="chart.png" alt="drawing" width="600"/>
